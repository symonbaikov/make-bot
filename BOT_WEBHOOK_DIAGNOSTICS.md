# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–æ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –æ–±—ã—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. ‚ùå Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway ‚Üí Bot —Å–µ—Ä–≤–∏—Å ‚Üí Logs
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
   ```
   ‚úÖ Webhook set successfully!
   Webhook status: { url: '...', ... }
   ```

**–ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç–µ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤:**
- Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_WEBHOOK_URL` –≤ Railway

### 2. ‚ùå Telegram –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway ‚Üí Bot —Å–µ—Ä–≤–∏—Å ‚Üí HTTP Logs
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –±–æ—Ç—É
3. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   POST /webhook 200
   ```

**–ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å–æ–≤:**
- Telegram –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Webhook URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### 3. ‚ùå Webhook URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   https://make-botbot-production.up.railway.app/health
   ```
2. –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: `{"status":"ok","mode":"webhook"}`

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ü–æ—Ä—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω

### 4. ‚ùå –ë–æ—Ç –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway ‚Üí Bot —Å–µ—Ä–≤–∏—Å ‚Üí Deploy Logs
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏:**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

## –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —Å—Ç–∞—Ç—É—Å –≤ Telegram

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_BOT_TOKEN` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω):

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "ok": true,
  "result": {
    "url": "https://make-botbot-production.up.railway.app/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0,
    "last_error_date": 0,
    "last_error_message": "",
    "max_connections": 40
  }
}
```

**–ï—Å–ª–∏ `url` –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
- Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç

**–ï—Å–ª–∏ `last_error_message` –Ω–µ –ø—É—Å—Ç–æ–π:**
- Telegram –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞

–í Railway –æ—Ç–∫—Ä–æ–π—Ç–µ **Bot —Å–µ—Ä–≤–∏—Å** ‚Üí **HTTP Logs** –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`:

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
POST /webhook 200
```

**–ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:**
- Telegram –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Webhook URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –®–∞–≥ 3: –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook

–ï—Å–ª–∏ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ:

1. –í Railway –¥–ª—è Bot —Å–µ—Ä–≤–∏—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   ```
   FORCE_WEBHOOK_RESET=true
   ```

2. –ò–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
   ```
   ALLOW_POLLING_IN_PRODUCTION=true
   ```
   –ò —É–¥–∞–ª–∏—Ç–µ `TELEGRAM_WEBHOOK_URL`

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook endpoint

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
curl -X POST https://make-botbot-production.up.railway.app/webhook \
  -H "Content-Type: application/json" \
  -d '{"update_id": 1, "message": {"message_id": 1, "from": {"id": 123, "is_bot": false}, "chat": {"id": 123}, "date": 1234567890, "text": "/start"}}'
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å `200 OK`.

## –ü–æ—á–µ–º—É –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ?

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
1. –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è webhook
3. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç pending updates (–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
4. –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö

**–ù–æ –Ω–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ:**
- Webhook URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
- –ò–ª–∏ webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ò–ª–∏ –±–æ—Ç –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —Å—Ç–∞—Ç—É—Å:**
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint:**
   ```bash
   curl https://make-botbot-production.up.railway.app/health
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - Railway ‚Üí Bot —Å–µ—Ä–≤–∏—Å ‚Üí HTTP Logs
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–æ—Å

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:**
   - Railway ‚Üí Bot —Å–µ—Ä–≤–∏—Å ‚Üí Settings ‚Üí Redeploy

5. **–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:**
   - –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ polling —Ä–µ–∂–∏–º–µ
   - –ó–∞—Ç–µ–º –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ webhook

