# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü—É—Å—Ç–æ–π Bundle –≤ Make Webhook

## –ü—Ä–æ–±–ª–µ–º–∞

–í Make webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø—É—Å—Ç–æ–π bundle (`[]`), —Ö–æ—Ç—è backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Content-Type

Make webhook –º–æ–∂–µ—Ç –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ `Content-Type` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `application/json`.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ).

### 2. –î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ Make

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `‚úÖ Webhook sent to Make successfully`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Make - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏

**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MAKE_WEBHOOK_URL` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### 3. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º Make

Make webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç JSON –æ–±—ä–µ–∫—Ç –≤ bundle, –Ω–æ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Make webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

## –ß—Ç–æ —è –¥–æ–±–∞–≤–∏–ª

### 1. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö webhook'–æ–≤

–í `webhook-controller.ts` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ü–æ–ª–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
- Content-Type
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π body

### 2. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Make

–í `make-service.ts` –¥–æ–±–∞–≤–ª–µ–Ω–æ:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ payload –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Make
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å response data

### 3. –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è webhook endpoints

–í `request-logger.ts` –¥–æ–±–∞–≤–ª–µ–Ω–æ:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö webhook –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π body
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ raw body (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

## –ö–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ webhook, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

**–í—Ö–æ–¥—è—â–∏–π webhook (–æ—Ç –±–æ—Ç–∞/PayPal):**
```
üîî Webhook request received {
  method: 'POST',
  path: '/api/webhook/bot',
  contentType: 'application/json',
  body: '{"sessionId":"...","email":"..."}',
  isEmpty: false
}
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Make:**
```
Sending webhook to Make {
  sessionId: '...',
  event: 'bot_email_collected',
  dataSize: 234,
  dataKeys: ['event', 'sessionId', 'email', ...]
}

Make webhook payload {
  payload: '{"event":"bot_email_collected",...}'
}

‚úÖ Webhook sent to Make successfully {
  sessionId: '...',
  responseStatus: 200
}
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Make Webhook

1. –û—Ç–∫—Ä–æ–π—Ç–µ Make webhook –º–æ–¥—É–ª—å
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ "Bundle content" - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ bundle

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Make

–í Make webhook –º–æ–¥—É–ª–µ:
- –û—Ç–∫—Ä–æ–π—Ç–µ "Bundle content" tab
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ï—Å–ª–∏ bundle –ø—É—Å—Ç–æ–π, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –®–∞–≥ 4: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é –≤ Make webhook:

```bash
curl -X POST https://hook.us1.make.com/your-webhook-url \
  -H "Content-Type: application/json" \
  -d '{
    "event": "bot_email_collected",
    "sessionId": "test-001",
    "email": "test@example.com",
    "tgUserId": "123456789",
    "plan": "STANDARD",
    "amount": 99.99
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í Make –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–±—ã—Ç–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏
- Bundle –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

## –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `MAKE_WEBHOOK_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```bash
# –í Railway –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
echo $MAKE_WEBHOOK_URL
```

URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```
https://hook.us1.make.com/your-webhook-id
```

### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Make Webhook

–í Make webhook –º–æ–¥—É–ª–µ:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "Custom webhook" –≤—ã–±—Ä–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ "Bundle content"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "Parse response" –≤–∫–ª—é—á–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏

Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{
  "event": "bot_email_collected",
  "sessionId": "...",
  "email": "...",
  ...
}
```

Make –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —ç—Ç–æ –≤ bundle. –ï—Å–ª–∏ bundle –ø—É—Å—Ç–æ–π, –≤–æ–∑–º–æ–∂–Ω–æ:
- Make –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
- Content-Type –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ Make

### –†–µ—à–µ–Ω–∏–µ 4: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ Make —Ç—Ä–µ–±—É–µ—Ç –º–∞—Å—Å–∏–≤ bundle'–æ–≤, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ `make-service.ts`:

```typescript
// –í–º–µ—Å—Ç–æ:
await axios.post(this.webhookUrl, data, ...)

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
await axios.post(this.webhookUrl, [{ data }], ...)
```

–ù–æ –æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - Make –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ bundle.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º webhook –∑–∞–ø—Ä–æ—Å–µ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Make webhook** - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–±—ã—Ç–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏
4. **–ï—Å–ª–∏ bundle –≤—Å–µ –µ—â–µ –ø—É—Å—Ç–æ–π:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Make webhook
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ Backend –ø–æ–ª—É—á–∞–µ—Ç webhook –æ—Ç –±–æ—Ç–∞/PayPal
2. ‚úÖ Backend –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
3. ‚úÖ Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Make
4. ‚úÖ Backend –ª–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
5. ‚úÖ Make –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞–µ—Ç bundle
6. ‚úÖ Bundle —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–æ–ª—è –∏–∑ payload

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Make
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é –≤ Make
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Make webhook –º–æ–¥—É–ª—è

