# Настройка условий Router в Make для проверки дубликатов

## Правильная логика Router

Судя по вашей схеме:

- **Путь 1 (1st)** → Google Sheets "Add a Row" → это путь для **"Email НЕ найден"**
- **Путь 2 (2nd)** → Пустой модуль → это путь для **"Email найден"**

## Настройка условий в Router

### Путь 1 (1st): "Email не найден" → Add a Row

**Условие должно быть:**

```
{{3.Rows.length}} = 0
```

или

```
{{3.Rows}} is empty
```

**Объяснение:**

- Если Search Rows (модуль #3) не нашел строки (пустой результат)
- Значит Email не существует в таблице
- Нужно добавить новую строку через "Add a Row"

### Путь 2 (2nd): "Email найден" → ничего не делать

**Условие должно быть:**

```
{{3.Rows.length}} > 0
```

или

```
{{3.Rows}} is not empty
```

**Объяснение:**

- Если Search Rows (модуль #3) нашел строки (результат не пустой)
- Значит Email уже существует в таблице
- Ничего не делаем (оставляем пустым)

## Важно: Номер модуля

⚠️ **В вашей схеме:**

- Webhooks = модуль #1
- Google Sheets "Add a Row" = модуль #2 (но это в пути Router'а)
- Google Sheets "Search Rows" = модуль #3

**Поэтому используйте `{{3.Rows}}`** для проверки результата Search Rows.

Если номера модулей отличаются в вашем сценарии, используйте правильный номер:

- Найдите модуль "Search Rows" в списке модулей
- Посмотрите его номер (например, #3)
- Используйте `{{3.Rows}}` в условиях Router

## Проверка правильности настройки

### Тест 1: Новый Email (не существует в таблице)

1. Search Rows вернет пустой результат (`{{3.Rows.length}} = 0`)
2. Router выберет **Путь 1 (1st)**
3. Выполнится "Add a Row" → новая строка добавится ✅

### Тест 2: Существующий Email (уже есть в таблице)

1. Search Rows найдет строку (`{{3.Rows.length}} > 0`)
2. Router выберет **Путь 2 (2nd)**
3. Ничего не произойдет → дубликат не создастся ✅

## Альтернативные варианты условий

Если `{{3.Rows.length}}` не работает, попробуйте:

### Вариант 1: Проверка через функцию

```
length({{3.Rows}}) = 0
```

### Вариант 2: Проверка через empty

```
{{3.Rows}} is empty
```

### Вариант 3: Проверка через exists

```
{{3.Rows}} does not exist
```

## Troubleshooting

### Проблема: Всегда выбирается один путь

**Решение:**

1. Проверьте номер модуля Search Rows (должен быть #3 в вашем случае)
2. Убедитесь, что используете правильный синтаксис: `{{3.Rows.length}}`
3. Проверьте логи выполнения Router'а в Make

### Проблема: Условия не работают

**Решение:**

1. Попробуйте использовать `{{3.Rows}} is empty` вместо `{{3.Rows.length}} = 0`
2. Убедитесь, что Search Rows правильно настроен и возвращает данные
3. Проверьте тип данных в Make - возможно нужно преобразовать в число

### Проблема: Неправильный номер модуля

**Как найти правильный номер:**

1. В Make откройте список всех модулей (обычно слева или внизу)
2. Найдите модуль "Google Sheets - Search Rows"
3. Посмотрите его номер (например, "3" или "Google Sheets 3")
4. Используйте этот номер в условиях Router
