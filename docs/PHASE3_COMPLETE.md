# Phase 3: Telegram Bot Development - –ó–ê–í–ï–†–®–ï–ù–û ‚úÖ

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Telegram –±–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Step 3.1: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ ‚úÖ

- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ —Å–æ–∑–¥–∞–Ω–∞:
  - `handlers/` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  - `middleware/` - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
  - `utils/` - —É—Ç–∏–ª–∏—Ç—ã
  - `types/` - TypeScript —Ç–∏–ø—ã
- ‚úÖ HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Backend API (`api-client.ts`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`logger.ts`)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email (`email-validator.ts`)

### Step 3.2: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π ‚úÖ

- ‚úÖ `/start` handler —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π session_id
  - –ü–∞—Ä—Å–∏–Ω–≥ session_id –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–º–∞–Ω–¥—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ session_id —á–µ—Ä–µ–∑ Backend API
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ (plan, amount)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ (–µ—Å–ª–∏ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–æ)
  - –ó–∞–ø—Ä–æ—Å email –∞–¥—Ä–µ—Å–∞
- ‚úÖ Email input handler
  - –í–∞–ª–∏–¥–∞—Ü–∏—è email —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ validator.js
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email (trim, lowercase)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Backend API
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ `/help` handler
  - –ü–æ–∫–∞–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### Step 3.3: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚úÖ

- ‚úÖ State management —á–µ—Ä–µ–∑ session middleware
  - In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ conversation flow
  - –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
  - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π/–∏—Å—Ç–µ–∫—à–∏–π session_id
  - –ü–ª–∞—Ç–µ–∂ —É–∂–µ —Å–æ–≤–µ—Ä—à–µ–Ω
  - –û—à–∏–±–∫–∏ Backend API
  - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ Error handling
  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### Step 3.4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API ‚úÖ

- ‚úÖ HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API
  - `getSession()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Å—Å–∏–∏
  - `sendBotWebhook()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö email collection
  - `healthCheck()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ webhook –¥–∞–Ω–Ω—ã—Ö
  - –û—Ç–ø—Ä–∞–≤–∫–∞ email, tgUserId, sessionId –≤ Backend
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Backend
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PayPal —Å—Å—ã–ª–∫–∏

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
bot/src/
‚îú‚îÄ‚îÄ handlers/              # Command and message handlers
‚îÇ   ‚îú‚îÄ‚îÄ start-handler.ts  # /start command handler
‚îÇ   ‚îú‚îÄ‚îÄ email-handler.ts  # Email input handler
‚îÇ   ‚îú‚îÄ‚îÄ help-handler.ts    # /help command handler
‚îÇ   ‚îî‚îÄ‚îÄ error-handler.ts   # Error handling
‚îú‚îÄ‚îÄ middleware/            # Bot middleware
‚îÇ   ‚îî‚îÄ‚îÄ session-middleware.ts  # Session state management
‚îú‚îÄ‚îÄ utils/                 # Utilities
‚îÇ   ‚îú‚îÄ‚îÄ api-client.ts      # Backend API client
‚îÇ   ‚îú‚îÄ‚îÄ email-validator.ts # Email validation
‚îÇ   ‚îú‚îÄ‚îÄ paypal.ts          # PayPal link generation
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts          # Logging utility
‚îú‚îÄ‚îÄ types/                 # TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           # Type definitions
‚îî‚îÄ‚îÄ index.ts               # Main bot file
```

---

## üîÑ User Flow

1. **User clicks link:** `https://t.me/your_bot?start=<session_id>`
2. **Bot receives:** `/start <session_id>` command
3. **Bot validates:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç session_id —á–µ—Ä–µ–∑ Backend API
4. **Bot requests:** –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç email –∞–¥—Ä–µ—Å
5. **User provides:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email
6. **Bot validates:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç email
7. **Bot sends:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Backend API (`POST /api/webhook/bot`)
8. **Bot provides:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ
9. **User pays:** –ó–∞–≤–µ—Ä—à–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ PayPal
10. **Backend processes:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç PayPal webhook
11. **User receives:** –ü–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è session_id
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Backend API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö/–∏—Å—Ç–µ–∫—à–∏—Ö session_id
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 2. Email Collection
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ validator.js
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email (trim, lowercase)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Backend API —Å retry –ª–æ–≥–∏–∫–æ–π

### 3. State Management
- In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ conversation flow
- –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 4. Error Handling
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 5. Integration
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PayPal —Å—Å—ã–ª–æ–∫

---

## üìù Environment Variables

```env
TELEGRAM_BOT_TOKEN="your-telegram-bot-token"
API_URL="http://localhost:3000"
TELEGRAM_BOT_USERNAME="your_bot_username"
PAYPAL_CLIENT_ID="your-paypal-client-id"
PAYPAL_MODE="sandbox"
```

---

## üöÄ –ó–∞–ø—É—Å–∫

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   npm install
   ```

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env:**
   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
   ```bash
   npm run dev
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –≤ Telegram
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/start <session_id>`

---

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç (`/start`, `/help`)
- ‚úÖ Email collection —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Error handling –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ State management —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `bot/README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–æ—Ç–∞
- `PHASE3_COMPLETE.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª (–æ—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏)

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 3 –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:

1. **Phase 4:** Frontend Development (Admin Panel)
2. **Phase 5:** Make Automation Scenarios
3. **Testing:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ flow

---

## ‚úÖ –ò–¢–û–ì

**Phase 3: Telegram Bot Development - –ó–ê–í–ï–†–®–ï–ù–û**

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- ‚úÖ Handlers –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API
- ‚úÖ State management
- ‚úÖ Error handling
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

